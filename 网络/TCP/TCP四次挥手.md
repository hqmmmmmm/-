为什么断开连接需要四次挥手？

因为TCP连接是全双工的嘛。当客户端没有数据需要发送时，会向服务器发送一个FIN报文，服务器回应一个ACK；此时可能服务器还有数据需要处理和发送，所以等到服务器不再需要发送数据时，就也会向客户端一样发送要给FIN报文给客户端，然后客户端回应一个ACK。这样能保证双方的连接都能正确的关闭。

---

特殊情况下，可能出现三次握手：客户端发送FIN报文断开连接时服务器也没有要发送的数据了 && 开启了TCP延迟确认。

客户端发送FIN报文断开连接时服务器也没有要发送的数据时，服务器的FIN报文和ACK会合并一起发送。

TCP延迟确认：当发送没有携带数据的ACK，它的网络效率是比较低的，因为它TCP头部就占了20个字节以上还有IP头部等等，但却没有携带数据报文。引入了TCP延迟确认就是当没有数据要发送时，ACK包会等待一会跟数据一起发送，不过如果对面重传的报文到了就不会等待了。
